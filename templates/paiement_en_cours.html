<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Paiement en cours - LuminaStar</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
body {font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#ff7eb3,#ff758c,#ffb199);color:#fff;min-height:100vh;margin:0;padding:0;}
.topbar {display:flex;justify-content:space-between;align-items:center;padding:15px;background:rgba(255,255,255,0.15);backdrop-filter:blur(15px);position:sticky;top:0;}
.sidebar {position:fixed;left:-260px;top:0;height:100%;width:260px;background:rgba(255,255,255,0.2);backdrop-filter:blur(12px);padding-top:80px;transition:.4s;z-index:999;border-right:1px solid rgba(255,255,255,0.25);}
.sidebar.active {left:0;}
.sidebar a {display:block;padding:14px 25px;color:#fff;text-decoration:none;}
.sidebar a:hover {background:rgba(255,255,255,0.25);}
.overlay {position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);opacity:0;visibility:hidden;transition:.3s;z-index:998;}
.overlay.active {opacity:1;visibility:visible;}
.main {padding:20px;}
.block {background:rgba(255,255,255,0.25);padding:20px;border-radius:20px;margin-top:25px;backdrop-filter:blur(10px);}
.block h2 {font-size:22px;margin-bottom:10px;}
.block p {font-size:16px;}
.loader {border:6px solid #f3f3f3;border-top:6px solid #ff7a00;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto;}
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="overlay" id="overlay"></div>
<div class="sidebar" id="sidebar">
    <a href="/dashboard"><i class="fa fa-home"></i> Tableau de bord</a>
    <a href="#"><i class="fa fa-wallet"></i> Compte inactif</a>
    <a href="/logout"><i class="fa fa-sign-out"></i> Déconnexion</a>
</div>

<div class="topbar">
    <div class="menu-toggle" id="menuToggle"><i class="fa fa-bars"></i></div>
    <div class="user">{{ user.username }}</div>
</div>

<div class="main">
    <div class="block">
        <h2>Paiement en cours...</h2>
        <p>Nous vérifions votre paiement. Cela peut prendre quelques secondes.</p>
        <div class="loader"></div>
        <p>Ne quittez pas cette page.</p>
    </div>
</div>

<script>
const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const menuToggle = document.getElementById("menuToggle");

menuToggle.onclick = () => { sidebar.classList.add("active"); overlay.classList.add("active"); };
overlay.onclick = () => { sidebar.classList.remove("active"); overlay.classList.remove("active"); };

// ✅ Vérifier toutes les 3 secondes si le compte est activé
setInterval(async () => {
    try{
        const res = await fetch('/api/check-activation', { cache: "no-store" });
        const data = await res.json();

        if(data.activated){
            window.location.href = '/dashboard';  // ✅ BONNE URL
        }
    }catch(e){
        console.log("Erreur check activation:", e);
    }
}, 3000);
</script>

</body>
</html>
